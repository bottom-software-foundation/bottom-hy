(import [functools [partial]])
(import os)
(import shlex)


;; it's jank but it'll do until I move stuff to functions
(defn test [file input expected-output]
    (do
        (with [fout (open "tmpinp.txt" "w+")] (.write fout input))
        (os.system (.join "" ["cat tmpinp.txt | hy " (shlex.quote file) " > tmp.txt"]))
        (with [fin (open "tmp.txt")]
            (= expected-output (.read fin)))))

(setv test-encode (partial test "encode.hy"))
(setv test-decode (partial test "decode.hy"))

(assert (test-encode "Test" "ğŸ’–âœ¨âœ¨âœ¨,,,,ğŸ‘‰ğŸ‘ˆğŸ’–ğŸ’–,ğŸ‘‰ğŸ‘ˆğŸ’–ğŸ’–âœ¨ğŸ¥ºğŸ‘‰ğŸ‘ˆğŸ’–ğŸ’–âœ¨ğŸ¥º,ğŸ‘‰ğŸ‘ˆ"))
(assert (test-encode "h" "ğŸ’–ğŸ’–,,,,ğŸ‘‰ğŸ‘ˆ"))
(assert (test-decode "ğŸ’–ğŸ’–,,,," "h"))
(assert (test-decode "ğŸ’–âœ¨âœ¨âœ¨,,,,\u200BğŸ’–ğŸ’–,\u200BğŸ’–ğŸ’–âœ¨ğŸ¥º\u200BğŸ’–ğŸ’–âœ¨ğŸ¥º,\u200B" "Test"))
(assert (test-decode "ğŸ’–âœ¨âœ¨âœ¨,,,,ğŸ‘‰ğŸ‘ˆğŸ’–ğŸ’–,ğŸ‘‰ğŸ‘ˆğŸ’–ğŸ’–âœ¨ğŸ¥ºğŸ‘‰ğŸ‘ˆğŸ’–ğŸ’–âœ¨ğŸ¥º,ğŸ‘‰ğŸ‘ˆ" "Test"))
(assert (test-encode "ğŸ¥º" "ğŸ«‚âœ¨âœ¨âœ¨âœ¨ğŸ‘‰ğŸ‘ˆğŸ’–ğŸ’–ğŸ’–ğŸ¥º,,,,ğŸ‘‰ğŸ‘ˆğŸ’–ğŸ’–ğŸ’–âœ¨ğŸ¥ºğŸ‘‰ğŸ‘ˆğŸ’–ğŸ’–ğŸ’–âœ¨âœ¨âœ¨ğŸ¥º,ğŸ‘‰ğŸ‘ˆ"))
(assert (test-encode "ãŒã‚“ã°ã‚Œ" "ğŸ«‚âœ¨âœ¨ğŸ¥º,,ğŸ‘‰ğŸ‘ˆğŸ’–ğŸ’–âœ¨âœ¨ğŸ¥º,,,,ğŸ‘‰ğŸ‘ˆğŸ’–ğŸ’–âœ¨âœ¨âœ¨âœ¨ğŸ‘‰ğŸ‘ˆğŸ«‚âœ¨âœ¨ğŸ¥º,,ğŸ‘‰ğŸ‘ˆğŸ’–ğŸ’–âœ¨âœ¨âœ¨ğŸ‘‰ğŸ‘ˆğŸ’–ğŸ’–âœ¨âœ¨âœ¨âœ¨ğŸ¥º,,ğŸ‘‰ğŸ‘ˆğŸ«‚âœ¨âœ¨ğŸ¥º,,ğŸ‘‰ğŸ‘ˆğŸ’–ğŸ’–âœ¨âœ¨ğŸ¥º,,,,ğŸ‘‰ğŸ‘ˆğŸ’–ğŸ’–ğŸ’–âœ¨âœ¨ğŸ¥º,ğŸ‘‰ğŸ‘ˆğŸ«‚âœ¨âœ¨ğŸ¥º,,ğŸ‘‰ğŸ‘ˆğŸ’–ğŸ’–âœ¨âœ¨âœ¨ğŸ‘‰ğŸ‘ˆğŸ’–ğŸ’–âœ¨âœ¨âœ¨âœ¨ğŸ‘‰ğŸ‘ˆ"))
(assert (test-decode "ğŸ«‚âœ¨âœ¨âœ¨âœ¨ğŸ‘‰ğŸ‘ˆğŸ’–ğŸ’–ğŸ’–ğŸ¥º,,,,ğŸ‘‰ğŸ‘ˆğŸ’–ğŸ’–ğŸ’–âœ¨ğŸ¥ºğŸ‘‰ğŸ‘ˆğŸ’–ğŸ’–ğŸ’–âœ¨âœ¨âœ¨ğŸ¥º,ğŸ‘‰ğŸ‘ˆ" "ğŸ¥º"))
(assert (test-decode "ğŸ«‚âœ¨âœ¨ğŸ¥º,,ğŸ‘‰ğŸ‘ˆğŸ’–ğŸ’–âœ¨âœ¨ğŸ¥º,,,,ğŸ‘‰ğŸ‘ˆğŸ’–ğŸ’–âœ¨âœ¨âœ¨âœ¨ğŸ‘‰ğŸ‘ˆğŸ«‚âœ¨âœ¨ğŸ¥º,,ğŸ‘‰ğŸ‘ˆğŸ’–ğŸ’–âœ¨âœ¨âœ¨ğŸ‘‰ğŸ‘ˆğŸ’–ğŸ’–âœ¨âœ¨âœ¨âœ¨ğŸ¥º,,ğŸ‘‰ğŸ‘ˆğŸ«‚âœ¨âœ¨ğŸ¥º,,ğŸ‘‰ğŸ‘ˆğŸ’–ğŸ’–âœ¨âœ¨ğŸ¥º,,,,ğŸ‘‰ğŸ‘ˆğŸ’–ğŸ’–ğŸ’–âœ¨âœ¨ğŸ¥º,ğŸ‘‰ğŸ‘ˆğŸ«‚âœ¨âœ¨ğŸ¥º,,ğŸ‘‰ğŸ‘ˆğŸ’–ğŸ’–âœ¨âœ¨âœ¨ğŸ‘‰ğŸ‘ˆğŸ’–ğŸ’–âœ¨âœ¨âœ¨âœ¨ğŸ‘‰ğŸ‘ˆ" "ãŒã‚“ã°ã‚Œ"))
(assert (test-encode "\0" "â¤ï¸ğŸ‘‰ğŸ‘ˆ"))
(assert (test-decode "â¤ï¸ğŸ‘‰ğŸ‘ˆ" "\0"))
